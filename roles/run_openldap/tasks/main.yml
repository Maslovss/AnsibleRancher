---
#- name: Pull OpenLDAP docker image
#  docker_image:
#    name: "{{  openldap_docker_image }}"
#    source: pull

- name: Check if OpenLDAP container is running
  docker_container_info:
    name: "{{ openldap_container_name }}"
  register: result

- name: Does container exist?
  debug:
    msg: "The container {{ 'exists' if result.exists else 'does not exist' }}"

- name: Print the status of the container
  debug:
    msg: "The container status is {{ result.container['State']['Status'] }}"
  when: result.exists

- name: Start OpenLDAP container
  docker_container:
    name: "{{ openldap_container_name }}"
    image: "{{ openldap_docker_image }}"
    state: started
    recreate: yes
    ports:
      - "{{ openldap_server_tls_port }}:{{ openldap_image_port }}"
      - "1636:1636"
    env:
      LDAP_ADMIN_USERNAME: "{{ openldap_admin_username }}"
      LDAP_ADMIN_PASSWORD: "{{ openldap_admin_password }}"
      LDAP_USERS: "{{ openldap_users_username }}"
      LDAP_PASSWORDS: "{{ openldap_users_password }}"
      LDAP_ROOT: "{{ openldap_image_port }}"
      LDAP_PORT_NUMBER: "{{ openldap_root }}"
#  when: "{{ result.container['State']['Status'] }}" != "running"
